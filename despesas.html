<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Despesas</title>
  <style>
    * { box-sizing: border-box; font-family: Arial, sans-serif; }
    body { padding: 20px; background-color: #f9f9f9; }
    h2 { text-align: center; }
    .topo { display: flex; justify-content: space-between; margin-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    button { margin: 5px; padding: 5px 10px; }
    input[type="text"], input[type="number"], input[type="date"] {
      width: 100%; padding: 8px; margin-bottom: 10px;
    }
    .formulario { background: #fff; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="topo">
    <div><strong>Usuário:</strong> <span id="usuarioLogado">---</span></div>
    <div><strong>Hora:</strong> <span id="horaAtual">--:--:--</span></div>
  </div>

  <h2>Cadastro de Despesas</h2>

  <div class="formulario">
    <label>Data:</label>
    <input type="date" id="dataDespesa">
    <label>Descrição da Despesa:</label>
    <input type="text" id="descricaoDespesa">
    <label>Valor:</label>
    <input type="number" id="valorDespesa" step="0.01">
    <button onclick="salvarDespesa()">Salvar Despesa</button>
  </div>

  <table id="tabelaDespesas">
    <thead>
      <tr>
        <th>Data</th>
        <th>Descrição</th>
        <th>Valor (R$)</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="text-align:center; margin-top:10px;">
    <button onclick="exportarPDF()">Exportar PDF</button>
    <button onclick="voltarPainel()">Voltar ao Painel</button>
  </div>

  <script>
    let despesas = JSON.parse(localStorage.getItem('despesas')) || [];
    let editandoIndex = null;

    function salvarDespesa() {
      const data = document.getElementById("dataDespesa").value;
      const descricao = document.getElementById("descricaoDespesa").value;
      const valor = parseFloat(document.getElementById("valorDespesa").value).toFixed(2);

      if (!data || !descricao || isNaN(valor)) return alert("Preencha todos os campos!");

      const nova = { data, descricao, valor };

      if (editandoIndex !== null) {
        despesas[editandoIndex] = nova;
        editandoIndex = null;
      } else {
        despesas.push(nova);
      }

      localStorage.setItem("despesas", JSON.stringify(despesas));
      listarDespesas();
      document.getElementById("dataDespesa").value = "";
      document.getElementById("descricaoDespesa").value = "";
      document.getElementById("valorDespesa").value = "";
    }

    function listarDespesas() {
      const tbody = document.querySelector("#tabelaDespesas tbody");
      tbody.innerHTML = "";
      despesas.forEach((d, i) => {
        tbody.innerHTML += `
          <tr>
            <td>${d.data}</td>
            <td>${d.descricao}</td>
            <td>R$ ${d.valor}</td>
            <td>
              <button onclick="editar(${i})">Editar</button>
              <button onclick="excluir(${i})">Excluir</button>
            </td>
          </tr>
        `;
      });
    }

    function editar(i) {
      const d = despesas[i];
      document.getElementById("dataDespesa").value = d.data;
      document.getElementById("descricaoDespesa").value = d.descricao;
      document.getElementById("valorDespesa").value = d.valor;
      editandoIndex = i;
    }

    function excluir(i) {
      if (confirm("Deseja excluir esta despesa?")) {
        despesas.splice(i, 1);
        localStorage.setItem("despesas", JSON.stringify(despesas));
        listarDespesas();
      }
    }

    function exportarPDF() {
      alert("Função de exportar PDF será implementada com jsPDF.");
    }

    function voltarPainel() {
      window.location.href = "painel.html";
    }

    function atualizarHora() {
      const agora = new Date();
      document.getElementById("horaAtual").textContent = agora.toLocaleTimeString();
    }

    setInterval(atualizarHora, 1000);
    atualizarHora();

    document.getElementById("usuarioLogado").textContent = localStorage.getItem("usuarioLogado") || "Desconhecido";
    listarDespesas();
  </script>
</body>
</html>
